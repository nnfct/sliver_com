
- new 1안
    
    ## 1. 제품 비전과 목표
    
    ## **제품 비전**
    
    > "시니어의 일상을 취미와 관계로 채우는 가장 안전하고 따뜻한 디지털 사랑방"
    > 
    
    우리는 기술의 복잡함 없이도 누구나 쉽게 관심사를 나누고 새로운 친구를 사귈 수 있는 공간을 만듭니다. '오늘, 우리'는 고립감을 해소하고, 의미 있는 관계를 통해 활기찬 시니어 라이프를 지원하는 것을 목표로 합니다.
    
    ## **해결하려는 문제**
    
    - **디지털 소외:** 기존 소셜 앱의 복잡한 기능과 작은 글씨로 인해 시니어 사용자들이 겪는 어려움
    - **관계의 단절:** 은퇴 후 사회적 관계망이 줄어들며 느끼는 외로움과 고립감
    - **관심사 공유의 어려움:** 비슷한 취미를 가진 또래를 만날 기회의 부족
    
    ## **핵심 성공 지표 (OKRs)**
    
    - **Objective (목표):** 4주 내 성공적인 MVP 출시로 시장 진입 및 초기 사용자 확보
        - **Key Result 1:** 신규 가입자 온보딩(프로필 생성) 완료율 > 80%
        - **Key Result 2:** 활성 사용자의 20% 이상이 첫 주 내 소모임 가입 또는 생성
        - **Key Result 3:** Lighthouse 기준 접근성 점수 > 90점
        - **Key Result 4:** 사용자 만족도(CSAT) 조사에서 '안전하다' 응답률 > 85%
    
    ## 2. 제품 범위와 기능 (MoSCoW 우선순위)
    
    4주라는 타임라인을 준수하기 위해 기능 범위를 명확히 정의합니다.
    
    ## **Must-Have (4주 내 필수 구현)**
    
    - **간편 가입 및 로그인:** OAuth2 소셜 로그인으로 비밀번호 없이 안전하게 시작합니다.
    - **내 프로필과 취미 태그:** 몇 번의 터치로 나를 표현하고 관심사를 선택합니다.
    - **관심사 기반 친구 추천:** 내 취미에 맞는 친구를 매일 추천받아 쉽게 관계를 시작합니다.
    - **소모임 개설 및 참여:** 등산, 독서, 맛집 탐방 등 원하는 주제의 모임을 만들고 참여합니다.
    - **1:1 채팅 및 쪽지:** 관심 있는 상대와 안전하게 대화를 나눕니다. (Azure Communication Services 활용)
    - **기본 관리자 페이지:** 회원 및 모임 관리를 위한 최소한의 운영 도구를 확보합니다. (Django Admin 활용)
    
    ## **Should-Have (MVP 이후 순차적 활성화)**
    
    - **AI 대화 시작 도우미:** 어색한 첫 대화를 AI가 자연스럽게 시작할 수 있도록 돕습니다. (Feature Flag로 관리)
    - **오프라인 모임 지원:** 온라인을 넘어 오프라인 만남을 위한 날짜와 장소 설정 기능을 제공합니다.
    - **사용자 신고 및 차단:** 불쾌한 사용자를 즉시 차단하고 신고하여 안전한 환경을 유지합니다.
    
    ## **Could-Have (v1.1 로드맵)**
    
    - **내 주변 친구/모임 찾기:** 위치 기반 서비스로 가까운 곳의 친구와 모임을 발견합니다.
    - **모임 후기 및 평점:** 신뢰도 높은 모임 문화를 만들기 위한 피드백 시스템을 도입합니다.
    - **음성 안내 및 입력 지원:** 시니어 접근성 강화를 위한 음성 인터페이스를 추가합니다.
    
    ## **Won't-Have (이번 버전 미포함)**
    
    - 실시간 라이브 방송, 커머스(쇼핑) 연동, 포인트/리워드 시스템
    
    ## 3. 사용자 경험(UX) 및 디자인 원칙
    
    **핵심 원칙: "단순하게, 안전하게, 누구나 쉽게"**
    
    ## **시니어 친화적 접근성 (필수 준수)**
    
    1. **가독성:** 모든 텍스트는 시스템 글꼴 크기 설정에 따라 **최대 130%까지 확대**되어도 레이아웃이 깨지지 않아야 합니다. (React Native **`maxFontSizeMultiplier`** 설정)
    2. **명확성:** WCAG 2.1 AA 기준에 따라 **4.5:1 이상의 명암비**를 유지하여 저시력 사용자도 쉽게 인지할 수 있어야 합니다.
    3. **조작성:** 모든 버튼과 링크는 **최소 44x44pt의 터치 영역**을 확보하여 실수 없는 터치를 보장해야 합니다.
    
    ## **핵심 사용자 여정**
    
    **`가입`** → **`프로필/관심사 선택`** → **`친구/모임 추천 확인`** → **`소모임 참여`** → **`1:1 대화`** → **`오프라인 만남`**
    
    ## 4. 기술 아키텍처 및 스택
    
    **아키텍처 철학: "Azure 관리형 서비스를 최우선으로 채택해 개발 속도와 안정성을 극대화한다."**
    
    | **구성 요소** | **기술 선택** | **선정 이유** |
    | --- | --- | --- |
    | **모바일 앱** | React Native (TypeScript) | 단일 코드로 iOS/Android 동시 개발, 강력한 접근성 기능 지원 |
    | **API 서버** | FastAPI (Python) | 높은 비동기 성능, 자동 API 문서 생성으로 개발 생산성 향상 |
    | **관리자 패널** | Django Admin (Python) | 개발 공수 없이 즉시 사용 가능한 강력하고 안전한 관리자 UI 확보 |
    | **데이터베이스** | PostgreSQL + PostGIS | 복잡한 매칭 쿼리와 향후 위치 기반 기능 확장에 최적화 |
    | **실시간 채팅** | Azure Communication Services | 직접 구현의 복잡성 없이 안정적인 1:1 채팅, 알림, 메시지 보관 기능 제공 |
    | **인증 시스템** | Azure AD B2C | 표준 OAuth2 기반의 안전하고 확장 가능한 사용자 인증 시스템 구축 |
    | **위치 서비스** | Azure Maps | 향후 '내 주변' 기능 구현을 위한 표준화된 지도/검색 API |
    | **AI 도우미** | Azure OpenAI | '대화 시작 도우미' 등 자연어 처리 기능을 손쉽게 통합 |
    
    ## 5. 프로젝트 실행 계획 및 리스크 관리
    
    ## **4주 실행 로드맵**
    
    - **1주차 (기반 다지기):** Azure 인프라 구축, CI/CD 설정, OAuth2 인증 플로우 완성, DB 스키마 설계
    - **2주차 (핵심 기능):** 소모임 개설/참여 기능, 태그 기반 매칭 알고리즘 MVP, 관리자 페이지 가동
    - **3주차 (소통과 안전):** 1:1 채팅 연동, 신고/차단 기능, AI 대화 도우미(Should) 구현
    - **4주차 (완성 및 배포):** 최종 QA, 접근성/성능 테스트, TestFlight/Closed Beta 배포 준비
    
    ## **리스크 관리**
    
    | **리스크** | **발생 가능성** | **영향도** | **완화 전략** |
    | --- | --- | --- | --- |
    | 4주 내 범위 초과 | 높음 | 높음 | MoSCoW 원칙 철저 준수, Should 기능은 Feature Flag로 제어 |
    | AD B2C 테넌트 제약 | 중간 | 높음 | 프로젝트 시작 즉시 기존 테넌트 가용성 확인, 대안(Auth0) 사전 조사 |
    | 시니어 사용성 저하 | 중간 | 높음 | 주 1회, 타겟 사용자(5명 이상)를 대상으로 사용성 테스트 진행 및 즉시 개선 |
    
    ## **완료의 정의 (Definition of Done)**
    
    - **기능:** Must-Have 기능 모두 구현 및 테스트 완료, Should-Have 기능은 Feature Flag 하에 통합
    - **품질:** 접근성 체크리스트 통과, API 응답 시간 목표 달성, 보안 취약점 점검 완료
    - **배포:** CI/CD 파이프라인을 통해 베타 버전 자동 배포 성공
    
    본 기획서는 4주라는 짧은 시간 안에 시장의 문제를 해결하고 사용 가치를 검증할 수 있는 가장 현실적이고 효과적인 청사진입니다.
    
- new 2안
    
    # 1) 핵심 결론 (요약)
    
    - **채택**: RN(Expo) 모바일, 웹(Next.js), PostgreSQL, Azure 전반, 관심사 기반 매칭, 커뮤니티, 1:1 채팅, 신고/차단, 시니어 UX 원칙.
    - **보완/수정**:
        - 백엔드 **FastAPI 단일화**(비동기·WS 유리) — *Django Admin 이점은 Retool/경량 Admin로 보완*.
        - 인증은 **OAuth2/OIDC on Azure AD B2C**(소셜 포함)로 표준화.
        - **쪽지**는 1:1 DM과 **단일 스레드**로 통합(메시지 타입으로 구분) → 모델·UX 단순화.
        - AI는 **Azure OpenAI + AI Search(RAG)** 직접 연동으로 시작, **Azure Bot Service는 차기**(채널 확장 필요 시).
        - 실시간은 **Azure Web PubSub** 사용(웹소켓 운영 부담 제거).
    - **보류(이번 MVP 제외/축소)**: 위치기반 탐색(스키마·인덱스만 선반영), 후기/평점, 음성 안내/입력, 영상 인증, 라이브 방송/커머스/포인트.
    
    ---
    
    # 2) 의사결정 매트릭스 (Adopt / Adjust / Defer)
    
    | 항목 | v1.1 제안 | 최종 결정 | 이유 |
    | --- | --- | --- | --- |
    | 모바일 앱 | React Native | **채택 (Expo)** | iOS/Android 동시 개발 + EAS로 초기 속도·배포 효율. |
    | 웹 | React(Next.js) | **채택(관리자·홍보 중심)** | 사용자 기능은 모바일 중심, 웹은 Admin/랜딩로 범위 축소해 4주 내 품질 확보. |
    | 백엔드 | Django / FastAPI | **보완: FastAPI 단일화** | 비동기/WS·타입 안정·경량. Admin은 Retool/경량 화면으로 대체. |
    | 인증 | OAuth2 | **보완: OIDC on Azure AD B2C** | 소셜·정책·MFA 일원화, Key Vault로 시크릿 관리. |
    | DB | PostgreSQL | **채택** | JSONB/CTE/PostGIS, 추천·검색·위치 확장에 유리. |
    | 실시간 | WebSocket 등 | **보완: Azure Web PubSub** | 연결/스케일/보안 매니지드. 운영 단순화. |
    | 스토리지 | Azure Blob | **채택 + CDN** | 프로필/게시 이미지, Front Door/CDN로 전송 최적화. |
    | AI | Azure Bot Service + OpenAI | **보완: OpenAI + AI Search(RAG)** | 앱 내 UX에 맞게 커스텀. Bot Service는 차기 멀티채널 시 도입. |
    | 매칭 | 관심사 기반 | **보완: 태그(Jaccard)+거리+활동성 가중** | 지역성·콜드스타트 대응, A/B로 가중치 조정 가능. |
    | 커뮤니티 | 글/댓글 | **채택 + 신고/차단 Must** | 안전을 핵심 가치로 상향. |
    | 채팅/쪽지 | 1:1 채팅 + 쪽지 | **보완: DM 단일 스레드** | message.type(note/text)로 통합, 모델·UI 간결. |
    | 오프라인 모임 | Should | **유지(Should)** | 일정/참가/출석 최소 기능만. |
    | 위치 기반 | Could | **보류(스키마 선반영)** | 권한/프라이버시·시간 부담 → 좌표·인덱스만 준비. |
    | 음성/영상 인증 | Could | **보류** | 접근성·안전 정책 정립 후. |
    | 후기/평점 | Could | **보류** | 신뢰/오남용 대비 로직 필요 → 차기. |
    
    ---
    
    # 3) 최종 스코프 (4주 MVP)
    
    ### Must
    
    - 회원가입/로그인(AD B2C OIDC·소셜), 프로필/취미 태그
    - 소모임 개설/가입/탈퇴, 커뮤니티(글/댓글/이미지)
    - **1:1 채팅(WS)** + **쪽지=DM 타입 통합**, 읽음·타이핑 기본
    - **신고/차단** + 운영자 처리(경고/정지)
    - 관심사 기반 추천 v0(태그 유사도+거리+활동성)
    - **AI 챗봇 + 대화 시작 도우미**(FAQ/정책 RAG, 모더레이션)
    - 관리자: 회원/신고/모임 기본 관리, 감사로그
    
    ### Should
    
    - 오프라인 모임 일정/참가/간단 체크인
    - 푸시 알림(FCM/APNs/웹푸시), 이미지 업로드 최적화
    
    ### Could
    
    - 위치 기반 탐색, 후기/평점, 음성 입력/안내, 선택적 영상 인증
    
    ---
    
    # 4) 아키텍처/스택 (최종)
    
    - **클라이언트**: RN(Expo) 앱 / Next.js(관리자·랜딩)
    - **API**: FastAPI(Async) on Azure App Service(or Container Apps)
    - **실시간**: Azure Web PubSub(WebSocket)
    - **데이터**: Azure Database for PostgreSQL(Flexible) + **Redis**(세션/캐시) + **Blob**(미디어)
    - **AI**: Azure OpenAI(GPT-4o/mini) + **Azure AI Search**(FAQ/정책 RAG)
    - **보안**: Azure AD B2C(OIDC), API Management(레이트리밋), Key Vault(시크릿), Front Door+WAF(출시 직전)
    - **관측**: Application Insights, Log Analytics
    - **CI/CD**: GitHub Actions(+ Alembic 마이그레이션)
    
    ---
    
    # 5) 데이터/도메인 설계(핵심만)
    
    - **threads/messages**로 `dm`·`group` 공통화, `message.type ∈ {text,image,system,note}` → *쪽지=note*
    - **reports/blocks** 표준화(타깃: user/post/comment/message), 운영자 큐 `reports(status,handled_by)`
    - **recommendations(user, target, score, reason_json)** → 투명성/튜닝 용이
    - **events**(Should) 스키마 선반영, 기능 토글
    - **audit_logs**: 관리자/민감 액션 전부 기록
    
    ---
    
    # 6) 마일스톤(4주, v1.1 대비 보정)
    
    **W1 — 인프라·인증·스키마**
    
    - AD B2C·APIM·DB·Blob·Web PubSub·Insights 프로비저닝(IaC), FastAPI 골격, 사용자/프로필/태그, RN/Next.js 부트스트랩
    
    **W2 — 모임/커뮤니티/관리자**
    
    - 그룹/멤버십·게시글/댓글·이미지 업로드, 신고/차단·감사로그, 추천 v0(태그+활동성)
    
    **W3 — 실시간·AI·안전**
    
    - 1:1 채팅(WS, 읽음/타이핑) + **쪽지 타입 통합**, AI 챗봇+대화 도우미(RAG)·모더레이션, 접근성 점검
    
    **W4 — 안정화·UAT·배포**
    
    - E2E/부하/보안 점검(OWASP Top10), 버그픽스, 앱스토어 내부 테스트 트랙/웹 프로덕션 배포
    
    > v1.1과 차이: Bot Service → OpenAI 직접/RAG, 쪽지 통합, Web PubSub 도입, 웹 사용자 기능 축소로 4주 리스크 완화.
    > 
    
    ---
    
    # 7) 시니어 UX 차별화 포인트
    
    - 글자 크기 **3단 토글**(시스템 폰트 연동), 고대비 모드
    - 하단 탭 4~5개(홈/모임/채팅/알림/마이)와 **큰 터치 영역(≥48dp)**
    - 입력 최소화(선택형 칩, 자동완성, 단계형 폼)
    - **안전 가이드 내장**(오프라인 만남 체크리스트, 사기 방지, 신고 유도 카피)
    
    ---
    
    # 8) 위험·완화
    
    - **4주 일정 타이트** → Must **고정**, Should 기능 토글로 이월 가능
    - **AD B2C·스토어 심사 지연** → 내부 테스트 트랙·웹 릴리스로 완충
    - **실시간 부하** → Web PubSub/메시지 크기 제한·이미지 압축
    - **콘텐츠 안전** → 모더레이션+신고 큐, 관리자 런북/템플릿
    
    ---
    
    # 9) 바로 실행 체크리스트
    
    - [ ]  Azure 구독/리소스 그룹/네이밍 컨벤션 확정
    - [ ]  AD B2C 테넌트·정책, 소셜 앱 키 준비(카카오/Google/Apple)
    - [ ]  GitHub Actions·환경변수(Key Vault)·Alembic 파이프라인
    - [ ]  RN(Expo)·Next.js·FastAPI 스캐폴딩 생성
    - [ ]  ERD 고정 및 Seed 데이터(태그/카테고리)
    - [ ]  UAT 참여자(40–60대 5~10명) 섭외
    
    # 📂 저장소 구조 (Monorepo 추천)
    
    ```
    so-momeet/
    ├── backend/                # FastAPI + SQLAlchemy + Alembic
    │   ├── alembic/
    │   ├── app/
    │   │   ├── main.py
    │   │   ├── api/
    │   │   ├── core/
    │   │   ├── models/
    │   │   ├── schemas/
    │   │   └── services/
    │   ├── requirements.txt
    │   └── alembic.ini
    │
    ├── frontend/               # React Native (Expo)
    │   ├── App.tsx
    │   ├── screens/
    │   ├── components/
    │   └── package.json
    │
    ├── admin-web/              # Next.js (관리자 페이지)
    │   ├── pages/
    │   ├── components/
    │   └── package.json
    │
    └── docker-compose.yml
    
    ```
    
    ---
    
    # 🗄️ ERD (초기 버전)
    
    ```mermaid
    erDiagram
        USER {
            int id PK
            string email
            string password_hash
            string name
            string age_range
            string gender
            string bio
            datetime created_at
        }
    
        PROFILE {
            int id PK
            int user_id FK
            string hobbies
            string tags
            string avatar_url
        }
    
        GROUP {
            int id PK
            string name
            string description
            datetime created_at
            int created_by FK
        }
    
        GROUP_MEMBER {
            int id PK
            int group_id FK
            int user_id FK
            string role
        }
    
        MESSAGE {
            int id PK
            int sender_id FK
            int receiver_id FK
            string content
            datetime sent_at
        }
    
        CHAT {
            int id PK
            int user1_id FK
            int user2_id FK
            datetime created_at
        }
    
        USER ||--o{ PROFILE : has
        USER ||--o{ GROUP_MEMBER : joins
        GROUP ||--o{ GROUP_MEMBER : contains
        USER ||--o{ MESSAGE : sends
        USER ||--o{ CHAT : participates
    
    ```
    
    ---
    
    # 🐍 FastAPI + Alembic 초기 마이그레이션
    
    ### 📌 backend/app/models/user.py
    
    ```python
    from sqlalchemy import Column, Integer, String, DateTime, ForeignKey
    from sqlalchemy.orm import relationship
    from datetime import datetime
    from app.core.db import Base
    
    class User(Base):
        __tablename__ = "users"
    
        id = Column(Integer, primary_key=True, index=True)
        email = Column(String(255), unique=True, nullable=False, index=True)
        password_hash = Column(String(255), nullable=False)
        name = Column(String(100), nullable=False)
        age_range = Column(String(50))
        gender = Column(String(20))
        bio = Column(String(500))
        created_at = Column(DateTime, default=datetime.utcnow)
    
        profile = relationship("Profile", back_populates="user")
        groups = relationship("GroupMember", back_populates="user")
    
    ```
    
    ### 📌 backend/app/core/db.py
    
    ```python
    from sqlalchemy import create_engine
    from sqlalchemy.ext.declarative import declarative_base
    from sqlalchemy.orm import sessionmaker
    import os
    
    DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://user:password@localhost:5432/somomeet")
    
    engine = create_engine(DATABASE_URL)
    SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
    
    Base = declarative_base()
    
    ```
    
    ### 📌 Alembic 초기 마이그레이션
    
    `alembic/versions/20250825_init.py`
    
    ```python
    from alembic import op
    import sqlalchemy as sa
    
    revision = "20250825_init"
    down_revision = None
    branch_labels = None
    depends_on = None
    
    def upgrade():
        op.create_table(
            "users",
            sa.Column("id", sa.Integer, primary_key=True),
            sa.Column("email", sa.String(255), nullable=False, unique=True),
            sa.Column("password_hash", sa.String(255), nullable=False),
            sa.Column("name", sa.String(100), nullable=False),
            sa.Column("age_range", sa.String(50)),
            sa.Column("gender", sa.String(20)),
            sa.Column("bio", sa.String(500)),
            sa.Column("created_at", sa.DateTime, server_default=sa.func.now()),
        )
    
    def downgrade():
        op.drop_table("users")
    
    ```
    

---

## 📊 좌측(기술 아키텍처 & 스택) vs 우측(의사결정 매트릭스) 비교표

| 구분 | 기술 아키텍처 & 스택 (좌측 표) | 의사결정 매트릭스 (우측 표) | 최종 결정 | 차이/보완점 (최종결정 사유) |
| --- | --- | --- | --- | --- |
| **모바일 앱** | React Native (TypeScript) | React Native (Expo) | **Expo (RN 기반)** | RN은 동일, 단 Expo 채택으로 EAS 빌드/배포 효율 ↑, iOS/Android 동시 개발 단순화 |
| **웹** | Django Admin (Python) | React(Next.js) | **Next.js + Retool/경량 Admin** | Django Admin은 개발 초기 편리하나 확장성 한계 → Next.js로 사용자/Admin/랜딩 통합, Retool로 관리 대체 |
| **API 서버** | FastAPI (Python) | Django / FastAPI 혼합 | **FastAPI 단일화** | Django 제거, 비동기/WS 대응·경량성 확보, 타입 안정성 ↑ |
| **인증** | Azure AD B2C | OAuth2 (→ OIDC on Azure AD B2C) | **OIDC on Azure AD B2C** | OAuth2 일반 표현 → OIDC 표준화 + MFA/소셜 연동 + Key Vault 관리로 보안/운영 강화 |
| **DB** | PostgreSQL + PostGIS | PostgreSQL | **PostgreSQL (+확장 고려)** | 좌측 PostGIS까지 언급 → 최종 PostgreSQL 기반 유지, JSONB/CTE/위치 확장 대비 |
| **실시간** | Azure Communication Services | WebSocket 등 | **Azure Web PubSub** | ACS는 전화·화상 특화로 과도, Web PubSub이 채팅/알림에 적합 + 운영 단순 |
| **스토리지** | Azure Blob | Azure Blob (+CDN) | **Blob + CDN(Front Door)** | 좌측 Blob만 → CDN 추가, 전송속도/캐싱 최적화 |
| **AI** | Azure OpenAI | Azure Bot Service + OpenAI | **Azure OpenAI + AI Search(RAG)** | Bot Service는 다채널 대응에 유용하나 MVP 범위 과도 → 앱 내 QA/요약은 OpenAI+AI Search 직결 |
| **매칭** | (언급 없음) | 관심사 기반(태그/Jaccard+거리+활동성) | **태그+거리+활동성 가중 매칭** | 좌측은 미언급, 우측은 알고리즘 구체화 → 품질 높은 매칭 제공 |
| **커뮤니티** | 글/댓글 | 글/댓글(+신고/차단 Must) | **글/댓글 + 신고/차단 필수** | 좌측 단순 CRUD, 우측은 안전 강화 → 신고/차단을 Must로 격상 |
| **채팅/쪽지** | 1:1 채팅 | 1:1 채팅 + 쪽지 | **DM 단일 스레드 (쪽지=note)** | 쪽지·DM 통합 → 단일 모델 유지, UI/UX 단순화 |
| **오프라인 모임** | (없음) | Should | **최소 기능 유지(일정/참가/체크인)** | 좌측 언급 없음, 우측은 최소 기능만 제공 → MVP 범위 내 유지 |
| **위치 기반** | Azure Maps | Could (스키마 선반영) | **보류, 스키마만 반영** | 좌측: Maps API 활용, 우측: 권한·프라이버시·시간 부담으로 차기 이월 |
| **음성/영상 인증** | (없음) | Could (보류) | **보류** | MVP 과도 범위, 정책/UX 정립 후 도입 예정 |
| **후기/평점** | (없음) | Could (보류) | **보류** | 신뢰성/악용 방지 로직 필요, MVP 이후 단계에서 고려 |

---

- 기술설계서
    
    # 커뮤니티 앱 기술설계서 (MVP 4주)
    
    ## 1) 목표 및 범위
    
    - **목표**: 50~60대 사용자를 위한 안전하고 직관적인 커뮤니티 앱 MVP 개발.
    - **스코프**:
        - **Must**: 로그인(OIDC), 프로필/태그, 소모임, 커뮤니티(글·댓글·이미지), 1:1 채팅(DM 통합), 신고/차단, 추천v0, AI 요약/RAG 챗봇, 관리자.
        - **Should**: 오프라인 모임 일정/참가, 푸시 알림, 이미지 업로드 최적화.
        - **Could**: 위치기반 탐색, 후기/평점, 음성/영상 인증, 포인트.
    
    ---
    
    ## 2) 시스템 아키텍처
    
    ```
    [RN Expo App]   [Next.js Admin/Web]
            │               │
            └── HTTPS ──────┘
                 │
       [Azure Front Door+CDN]
                 │
       [Azure API Management]
                 │
          [FastAPI Backend]
             │       │
             │       ├── [Azure Web PubSub] (실시간 채팅/알림)
             │
     ┌───────┴─────────┐
     │                 │
    [PostgreSQL]   [Blob Storage]
       │                 │
       ▼                 │
    [AI Search] <──> [Azure OpenAI]
       │
    [Content Safety]
    
    ```
    
    - 인증: Azure AD B2C (OIDC, 소셜 로그인)
    - 보안: Key Vault(비밀키), API Mgmt(레이트리밋), WAF
    - 모니터링: App Insights + Log Analytics
    
    ---
    
    ## 3) 기술 스택
    
    - **프론트**: RN(Expo), Zustand, TanStack Query, Gluestack UI
    - **웹(Admin)**: Next.js, Shadcn UI, TanStack Table
    - **백엔드**: FastAPI, SQLAlchemy, Alembic
    - **DB**: PostgreSQL, Redis(세션/캐시)
    - **실시간**: Azure Web PubSub
    - **AI**: Azure OpenAI(GPT-4o/mini), AI Search, Content Safety
    - **DevOps**: GitHub Actions, IaC(Bicep), Docker
    
    ---
    
    ## 4) 데이터/도메인 모델 (핵심)
    
    - **users**(id, oidc_sub, email, name, age_range, gender, trust_score)
    - **profiles**(user_id, avatar_url, bio, region, font_scale, high_contrast)
    - **tags, user_tags** (취미/관심사 관리)
    - **groups, group_members** (소모임 관리)
    - **posts, comments** (요약, vector 포함)
    - **threads, thread_participants, messages** (DM/그룹 공통, message.type={text,image,note})
    - **reports, blocks** (신고/차단)
    - **recommendations** (추천 기록/스코어/이유 JSON)
    - **audit_logs** (관리자·민감 액션 기록)
    
    ---
    
    ## 5) 기능 설계
    
    ### 5.1 인증/보안
    
    - AD B2C OIDC → Access Token 발급
    - APIM에서 1차, FastAPI에서 2차 JWT 검증
    - MFA/소셜(OAuth2) 지원
    
    ### 5.2 피드/추천
    
    - Embedding 기반 벡터 유사도
    - 점수식: `0.7*cosine + 0.2*author_activity + 0.1*freshness`
    - AI Search or PGVector 인덱스 활용
    
    ### 5.3 AI 요약/RAG
    
    - 글/댓글 업로드 → Queue → Function 워커 → 요약 생성
    - FAQ/정책 문서 → AI Search 인덱싱 → GPT 응답
    - 프롬프트: “핵심 활동/시간·장소/참여조건, 3줄, 150자”
    
    ### 5.4 채팅/DM
    
    - 단일 thread_id per user pair
    - Web PubSub 이벤트: `message.new`, `typing`, `read`
    - DM 쪽지는 message.type=`note`로 구분
    
    ### 5.5 신고/차단
    
    - Content Safety 전처리 → 위험 감지 시 차단 팝업
    - 신고: reports 테이블, 관리자 Workflow
    - 차단: blocks 테이블, feed/채팅 차단 반영
    
    ---
    
    ## 6) API 설계 (요약)
    
    - `/auth/me` → 사용자 정보
    - `/posts` → 글 생성, 요약 처리
    - `/feed` → 개인화 점수순 피드
    - `/threads/dm/upsert` → DM 스레드 생성/조회
    - `/messages` → 메시지 CRUD
    - `/reports`, `/blocks` → 신고/차단
    - `/ai/summarize`, `/ai/ask` → AI 요약/RAG
    
    샘플 응답:
    
    ```json
    {
      "post_id": "p-123",
      "summary": "초보 등산·토요일 오전 9시·운동화 OK",
      "score": 0.82
    }
    
    ```
    
    ---
    
    ## 7) 실시간 이벤트 (Web PubSub)
    
    ```json
    {
      "type": "message.new",
      "thread_id": "t-1",
      "message": {
        "id": "m-1",
        "type": "text",
        "text": "안녕하세요"
      }
    }
    
    ```
    
    ---
    
    ## 8) 보안/개인정보
    
    - 개인정보 최소 저장 (전화번호 X, 지역=구 단위)
    - Key Vault로 API 키 관리
    - Content Safety+관리자 신고 이중 방어
    - 감사로그(민감 액션 90~180일 보관)
    
    ---
    
    ## 9) 운영/관측
    
    - SLO: p95 < 300ms, 오류율 <1%, WS 연결 >99%
    - 모니터링 지표: 트래픽, 요약 실패율, 신고 처리 TTR
    - 알람: 오류율 >2%, 요약 실패율 >20%
    
    ---
    
    ## 10) CI/CD
    
    - GitHub Actions → Lint/Test/Build/Deploy
    - Alembic 마이그레이션 자동 적용
    - IaC: Bicep 리소스 선언
    - 스토어: 앱스토어 내부 테스트 → 프로덕션
    
    ---
    
    ## 11) 테스트 전략
    
    - 단위: 모델/서비스 로직
    - 통합: 글 작성→요약→피드 노출 플로우
    - E2E: 로그인→게시→채팅→신고 시나리오
    - 부하: 채팅 동시접속 1k, 요약 배치 처리량
    - 보안: JWT 검증, 파일 업로드 MIME 제한
    
    ---
    
    ## 12) 리스크 및 대응
    
    - **일정 타이트** → Must 고정, Should 기능 토글
    - **AI 비용 과다** → mini 모델 우선, nightly 배치
    - **WS 스케일** → PubSub 요금제 관리, 메시지 크기 제한
    - **스토어 심사 지연** → 내부 테스트 트랙 활용
    
    ---
    
    ## 13) 마일스톤 (4주)
    
    - W1: 인프라/인증/스키마
    - W2: 그룹/게시글/신고/추천v0
    - W3: 채팅/실시간/AI 요약·RAG/모더레이션
    - W4: 안정화/UAT/배포
    
    ---
    
    ✅ 이 설계서는 **개발 지시서/로드맵**의 기준 문서로 활용할 수 있습니다.
    
    👉 원하시면 제가 이 문서를 **OpenAPI 스펙(YAML)** + **DB 마이그레이션 SQL** 패키지로 변환해드릴 수도 있습니다. 진행해드릴까요?
    
- 개발 작업 지시서
    
    # 커뮤니티 앱 개발 작업 지시서 (MVP 4주)
    
    - 버전/작성일: v1.0 / 2025-08-26 (KST)
    - 대상: 50·60대 친화 커뮤니티 앱(모바일 우선), 4주 MVP
    - 목적: 기술설계서를 기반으로 개발자별/주차별로 실행 가능한 **작업 지시사항** 제공
    
    ---
    
    ## 1) 공통 원칙
    
    - **Must 스코프 고정**: 로그인, 프로필/태그, 소모임, 커뮤니티, DM, 신고/차단, 추천v0, AI 요약/RAG, 관리자 기능.
    - **4주 내 완성**: 기능 범위 축소보다 품질 확보 우선.
    - **Azure 서비스 적극 활용**: AD B2C, Blob, Web PubSub, OpenAI, AI Search.
    - **DevOps 자동화**: IaC, GitHub Actions.
    
    ---
    
    ## 2) 주차별 작업 지시
    
    ### W1 — 인프라/인증/스켈레톤
    
    - **DevOps 팀**
        - Azure 구독/리소스 그룹/네이밍 규칙 확정.
        - DB(PostgreSQL), Blob, Web PubSub, App Insights, AD B2C 테넌트 생성.
        - GitHub Actions 파이프라인 생성(lint, test, build, deploy).
    - **백엔드 팀**
        - FastAPI 프로젝트 구조(app/main.py, api, models, schemas).
        - Alembic 초기 마이그레이션(users, profiles, tags).
        - AD B2C OIDC 로그인 구현(`/auth/me`).
    - **프론트엔드 팀 (RN)**
        - Expo 앱 초기화, 하단 탭 구조, 글로벌 테마(글자 크기 토글, 고대비).
        - 로그인 플로우(OIDC WebView/Redirect).
    - **웹팀 (Next.js)**
        - 관리자 페이지 스켈레톤 생성, 로그인 연동.
    
    ### W2 — 커뮤니티/관리자
    
    - **백엔드 팀**
        - 그룹/멤버십 API(`/groups`, `/groups/{id}/members`).
        - 게시글/댓글 CRUD + Blob 이미지 업로드.
        - 신고(`/reports`)·차단(`/blocks`) API.
        - 추천 v0 API(태그+활동성 가중치).
    - **프론트엔드 팀 (RN)**
        - 온보딩(관심사·지역 선택, 태그 저장).
        - 홈 피드 화면: 요약 카드 리스트.
        - 글 작성/댓글 작성/이미지 업로드.
        - 신고/차단 버튼 처리.
    - **웹팀 (Next.js)**
        - 관리자: 회원 검색/정지, 신고 처리 워크플로우.
        - 감사로그 화면.
    
    ### W3 — 실시간/AI/안전
    
    - **백엔드 팀**
        - Threads/Messages 스키마/엔드포인트(`/threads/dm/upsert`, `/threads/{id}/messages`).
        - Web PubSub 연동(읽음·타이핑 이벤트).
        - AI 요약 워커(Azure Function) → posts.summary 업데이트.
        - RAG 질의응답 API(`/ai/ask`).
        - Content Safety 미들웨어 적용.
    - **프론트엔드 팀 (RN)**
        - DM UI 구현(단일 스레드, 읽음/타이핑 표시).
        - AI 챗봇 대화 시작 도우미 화면.
        - Content Safety 경고 팝업.
    - **웹팀 (Next.js)**
        - 관리자: 채팅/신고 모니터링.
    
    ### W4 — 안정화/테스트/배포
    
    - **QA 팀**
        - E2E: 가입→피드→게시→DM→신고 시나리오.
        - 부하: WS 동시 1k, 요약 배치 처리량.
        - 보안: JWT 검증, OWASP Top10, 파일 업로드 제한.
    - **DevOps 팀**
        - CI/CD 최종 점검, UAT 빌드, 앱스토어 내부 테스트 업로드.
        - 알람/대시보드(App Insights) 설정.
    - **개발팀 전체**
        - 버그픽스, 사용자 피드백 반영.
    
    ---
    
    ## 3) 역할별 작업 분담
    
    - **프론트엔드(RN)**: 온보딩, 피드, 글쓰기, DM, 알림/팝업, 프로필.
    - **백엔드(FastAPI)**: 인증, 커뮤니티 API, DM API, 신고/차단, 추천, AI 연동.
    - **웹(Next.js)**: 관리자 페이지, 회원/신고/모임 관리, 감사로그.
    - **DevOps**: Azure 리소스/IaC, CI/CD, 모니터링/알람.
    - **QA**: E2E/부하/보안테스트.
    
    ---
    
    ## 4) QA 체크리스트
    
    - [ ]  로그인/온보딩 정상.
    - [ ]  피드 요약 카드 표시.
    - [ ]  글 작성 후 summary 생성.
    - [ ]  DM WS 이벤트(읽음/타이핑) 정상.
    - [ ]  신고/차단 처리 후 관리자 웹 반영.
    - [ ]  Content Safety 차단 팝업 정상.
    - [ ]  AI RAG 질의 응답 반환.
    
    ---
    
    ## 5) 최종 산출물
    
    - RN 앱(iOS/Android 내부 테스트)
    - FastAPI 백엔드(App Service)
    - Next.js 관리자 페이지(웹 프로덕션)
    - PostgreSQL DB 스키마 + Alembic 마이그레이션
    - IaC(Bicep) + GitHub Actions 워크플로우
    - 테스트 결과 보고서
    
    ---
    
    **끝.**
    

###